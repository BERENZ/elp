
# Wczytywanie i zapisywanie plików {#io}

<!-- A flat file can be a plain text file or a binary file. In the former case, the files usually contain one record per line -->
<!-- csv better than many! -->
<!-- folder roboczy -->

## Folder roboczy

Folder roboczy (ang. *working directory*) to miejsce na dysku, w którym aktualnie pracujemy.
Folder roboczy można sprawdzić korzystając z funkcji `getwd()`:


```r
getwd()
#> [1] "/home/travis/build/Nowosad/elp"
```

Zmienić folder roboczy można za pomocą skrótu *Ctrl+Shift+H* w RStudio (inaczej *Session -> Set Working Directory -> Choose Directory..*) lub też funkcji `setwd()`:


```r
setwd("home/jakub/Documents/elp/") #unix
setwd("C:/Users/jakub/Documenty/elp/") #windows
```

\BeginKnitrBlock{rmdinfo}<div class="rmdinfo">Ustawienie folderu roboczego ma też miejsce przy tworzeniu nowego lub otwieraniu istniejącego projektu RStudio.</div>\EndKnitrBlock{rmdinfo}

Folder roboczy jest ważny ponieważ pozwala na korzystanie z względnej ścieżki.
Ścieżka względna oznacza określanie ścieżki pliku w odniesieniu do istniejącego folderu roboczego, podczas, gdy ścieżka bezwzględna opisuje pełne położenie pliku.
Przykładowo, mamy plik `dane_meteo.csv`, którego pełna ścieżka to `home/jakub/Documents/elp/pliki/dane_meteo.csv`.
Z poziomu R ten plik jest widoczny zarówno jako `home/jakub/Documents/elp/pliki/dane_meteo.csv`, ale też w postaci `pliki/dane_meteo.csv`^[Jeżeli poprawnie ustawiliśmy folder roboczy.].
Używanie ścieżek względnych jest rekomendowane, ponieważ znacząco upraszcza pracę, gdy dane/obliczenia przenosi się pomiędzy różnymi komputerami lub gdy współpracuje się z innymi osobami.
Ścieżki względne są też używane w połączeniu z systemami kontroli wersji (rozdział \@ref(kontrola-wersji)).

\BeginKnitrBlock{rmdinfo}<div class="rmdinfo">Ścieżki folderów w systemach Windows są domyślnie rozdzielane ukośnikiem wstecznym (`\`, ang. *backslash*), jednak R pozwala także na użycie prawego ukośnika (`/`, ang. *slash*).
Prawy ukośnik jest rekomendowany, ponieważ działa on zarówno na Windowsach, jak i komputerach z systemami MacOS czy Linux.</div>\EndKnitrBlock{rmdinfo}

<!-- footnote with fs and here pacakges -->

## Wczytywanie plików tekstowych

`"pliki/dane_meteo.csv"`


```
#> [1] "kod_stacji,nazwa_stacji,rok,miesiac,dzien,tavg,precip,humidity,pressure"
#> [2] "352160330,POZNAŃ,2017,1,1,1.4,0,78,1017.9"                              
#> [3] "352160330,POZNAŃ,2017,1,2,0.1,0,84,1013.1"                              
#> [4] "352160330,POZNAŃ,2017,1,3,0.5,4.8,91.1,1012.1"                          
#> [5] "352160330,POZNAŃ,2017,1,4,1.5,2.3,84.9,996.1"
```


```r
meteo = read.csv("pliki/dane_meteo.csv", 
                 stringsAsFactors = FALSE)
str(meteo)
#> 'data.frame':	730 obs. of  9 variables:
#>  $ kod_stacji  : int  352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 ...
#>  $ nazwa_stacji: chr  "POZNAŃ" "POZNAŃ" "POZNAŃ" "POZNAŃ" ...
#>  $ rok         : int  2017 2017 2017 2017 2017 2017 2017 2017 2017 2017 ...
#>  $ miesiac     : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ dzien       : int  1 2 3 4 5 6 7 8 9 10 ...
#>  $ tavg        : num  1.4 0.1 0.5 1.5 -3.5 -8.4 -7.9 -7.7 -5.8 -5 ...
#>  $ precip      : num  0 0 4.8 2.3 0 0 2.1 0 0 0 ...
#>  $ humidity    : num  78 84 91.1 84.9 68.3 78.6 82.5 78.5 88.6 75.3 ...
#>  $ pressure    : num  1018 1013 1012 996 1021 ...
```

`read.csv()` `read.csv2()`


```r
meteo = read.table("pliki/dane_meteo.csv", 
                   sep = ",",
                   header = TRUE)
str(meteo)
#> 'data.frame':	730 obs. of  9 variables:
#>  $ kod_stacji  : int  352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 ...
#>  $ nazwa_stacji: Factor w/ 2 levels "POZNAŃ","ZAKOPANE": 1 1 1 1 1 1 1 1 1 1 ...
#>  $ rok         : int  2017 2017 2017 2017 2017 2017 2017 2017 2017 2017 ...
#>  $ miesiac     : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ dzien       : int  1 2 3 4 5 6 7 8 9 10 ...
#>  $ tavg        : num  1.4 0.1 0.5 1.5 -3.5 -8.4 -7.9 -7.7 -5.8 -5 ...
#>  $ precip      : num  0 0 4.8 2.3 0 0 2.1 0 0 0 ...
#>  $ humidity    : num  78 84 91.1 84.9 68.3 78.6 82.5 78.5 88.6 75.3 ...
#>  $ pressure    : num  1018 1013 1012 996 1021 ...
```

\BeginKnitrBlock{rmdinfo}<div class="rmdinfo">`read.delim()`, `read.delim2()`, `readLines()`, `read.fwf()`</div>\EndKnitrBlock{rmdinfo}

## Zapisywanie plików tekstowych


```r
meteo_pzn = subset(meteo, nazwa_stacji == "POZNAŃ")
str(meteo_pzn)
#> 'data.frame':	365 obs. of  9 variables:
#>  $ kod_stacji  : int  352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 352160330 ...
#>  $ nazwa_stacji: Factor w/ 2 levels "POZNAŃ","ZAKOPANE": 1 1 1 1 1 1 1 1 1 1 ...
#>  $ rok         : int  2017 2017 2017 2017 2017 2017 2017 2017 2017 2017 ...
#>  $ miesiac     : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ dzien       : int  1 2 3 4 5 6 7 8 9 10 ...
#>  $ tavg        : num  1.4 0.1 0.5 1.5 -3.5 -8.4 -7.9 -7.7 -5.8 -5 ...
#>  $ precip      : num  0 0 4.8 2.3 0 0 2.1 0 0 0 ...
#>  $ humidity    : num  78 84 91.1 84.9 68.3 78.6 82.5 78.5 88.6 75.3 ...
#>  $ pressure    : num  1018 1013 1012 996 1021 ...
```


```r
write.csv(meteo, "pliki/dane_meteo_pzn.csv",
          row.names = FALSE)
```

\BeginKnitrBlock{rmdinfo}<div class="rmdinfo">Funkcje `read.csv()` czy `write.csv()` są domyślnie dostępne w języku R.
Ich wydajność nie jest niestety najlepsza w przypadku plików tekstowych o dużej wielkości.
W takich przypadkach warto użyć alternatywnych funkcji, np. `read_csv()` i `write_csv()` z pakietu **readr** lub `fread()` i `fwrite()` z pakietu **data.table**.</div>\EndKnitrBlock{rmdinfo}

## Inne formaty

<!-- serializacja? -->
<!-- - RDS -->
<!-- - Excel -->
<!-- - Internet -->
<!-- - dane w pakietach -->
<!-- - bazy danych -->
<!-- - pliki przestrzenne -->
<!-- - json -->
<!-- tworzenie polaczen -->

## Działania na plikach i folderach

<!-- dir.create() -->
<!-- file.remove() -->
<!-- unlink -->
<!-- remove folder -->

## Zadania

<!-- wczytaj jeden format, zapisz inny -->
<!-- automatycznie wczytaj dwa pliki -->
<!-- wczytaj, zamien, zapisz -->
<!-- napisz funkcje do zamiany -->

