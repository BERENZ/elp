# Wczytywanie i zapisywanie plików {#io}

<!-- A flat file can be a plain text file or a binary file. In the former case, the files usually contain one record per line -->
<!-- csv better than many! -->
<!-- folder roboczy -->

## Folder roboczy

Folder roboczy (ang. *working directory*) to miejsce na dysku, w którym aktualnie pracujemy.
Folder roboczy można sprawdzić korzystając z funkcji `getwd()`:

```{r}
getwd()
```

Zmienić folder roboczy można za pomocą skrótu *Ctrl+Shift+H* w RStudio (inaczej *Session -> Set Working Directory -> Choose Directory..*) lub też funkcji `setwd()`:

```{r, eval=FALSE}
setwd("home/jakub/Documents/elp/") #unix
setwd("C:/Users/jakub/Documenty/elp/") #windows
```

```{block2 type="rmdinfo"}
Ustawienie folderu roboczego ma też miejsce przy tworzeniu nowego lub otwieraniu istniejącego projektu RStudio.
```

Folder roboczy jest ważny ponieważ pozwala na korzystanie z względnej ścieżki.
Ścieżka względna oznacza określanie ścieżki pliku w odniesieniu do istniejącego folderu roboczego, podczas, gdy ścieżka bezwzględna opisuje pełne położenie pliku.
Przykładowo, mamy plik `dane_meteo.csv`, którego pełna ścieżka to `home/jakub/Documents/elp/pliki/dane_meteo.csv`.
Z poziomu R ten plik jest widoczny zarówno jako `home/jakub/Documents/elp/pliki/dane_meteo.csv`, ale też w postaci `pliki/dane_meteo.csv`^[Jeżeli poprawnie ustawiliśmy folder roboczy.].
Używanie ścieżek względnych jest rekomendowane, ponieważ znacząco upraszcza pracę, gdy dane/obliczenia przenosi się pomiędzy różnymi komputerami lub gdy współpracuje się z innymi osobami.
Ścieżki względne są też używane w połączeniu z systemami kontroli wersji (rozdział \@ref(kontrola-wersji)).

```{block2 type="rmdinfo"}
Ścieżki folderów w systemach Windows są domyślnie rozdzielane ukośnikiem wstecznym (`\`, ang. *backslash*), jednak R pozwala także na użycie prawego ukośnika (`/`, ang. *slash*).
Prawy ukośnik jest rekomendowany, ponieważ działa on zarówno na Windowsach, jak i komputerach z systemami MacOS czy Linux.
```

<!-- footnote with fs and here pacakges -->

## Wczytywanie plików tekstowych

`"pliki/dane_meteo.csv"`

```{r, echo=FALSE}
m = readLines("pliki/dane_meteo.csv", n = 5)
m
```

```{r}
meteo = read.csv("pliki/dane_meteo.csv", 
                 stringsAsFactors = FALSE)
str(meteo)
```

`read.csv()` `read.csv2()`

```{r}
meteo = read.table("pliki/dane_meteo.csv", 
                   sep = ",",
                   header = TRUE)
str(meteo)
```

```{block2 type="rmdinfo"}
R posiada kilka dodatkowych funkcji pozwalających na odczytywanie plików tekstowych, tj. `read.delim()`, `read.delim2()`, `read.fwf()`, czy `readLines()`.
Funkcje `read.delim()` oraz `read.delim2()` są odpowiednikami `read.csv()` i `read.csv2()` dla plików, gdzie kolejne zmienne są oddzielane tabulatorami.
Funkcja `read.fwf()` służy do odczytywania danych o ustalonej długości kolejnych zmiennych.
Funkcja `readLines()` wczytuje kolejne linie z pliku tekstowego.
Efektem jej działania w przeciwieństwie do poprzednich funkcji nie jest ramka danych, ale wektor tekstowy, gdzie każdy kolejny element wektora to tekst z kolejnych linii.
```

## Zapisywanie plików tekstowych

```{r}
meteo_pzn = subset(meteo, nazwa_stacji == "POZNAŃ")
str(meteo_pzn)
```

```{r, eval=FALSE}
write.csv(meteo, "pliki/dane_meteo_pzn.csv",
          row.names = FALSE)
```

```{block2 type="rmdinfo"}
Funkcje `read.csv()` czy `write.csv()` są domyślnie dostępne w języku R.
Ich wydajność nie jest niestety najlepsza w przypadku plików tekstowych o dużej wielkości.
W takich przypadkach warto użyć alternatywnych funkcji, np. `read_csv()` i `write_csv()` z pakietu **readr** lub `fread()` i `fwrite()` z pakietu **data.table**.
```

## Formaty R

<!-- info about binary -->

```{r}
meteo$nazwa_stacji = as.factor(meteo$nazwa_stacji)
str(meteo)
```

```{r, eval=FALSE}
saveRDS(meteo, "pliki/dane_meteo.rds")
```

```{r}
meteo_rds = readRDS("pliki/dane_meteo.rds")
str(meteo_rds)
```

```{block2 type="rmdinfo"}
Dodatkowo możliwe jest zapisywanie wielu obiektów do jednego pliku w formacie `.rda` a następnie ich odczytanie używając wbudowanych funkcji `save()` i `load()`.
```

```{r, eval=FALSE}
data(package = "datasets")
```

```{r}
data("faithful", package = "datasets")
head(faithful)
```

## Arkusze kalkulacyjne

```{r}
library(readxl)
meteo_z_xl = read_excel("pliki/dane_meteo.xlsx")
meteo_z_xl
```

```{r, echo=FALSE, eval=FALSE}
writexl::write_xlsx(meteo, "pliki/dane_meteo.xlsx")
```

`write_xlsx()` z pakietu **writexl**

## Dane internetowe

```{r}
download.file("", destfile = "")
```

```{block2 type="rmdinfo"}
`download.file()` `mode`
```

## Inne formaty

<!-- serializacja? -->
<!-- bazy danych -->
<!-- pliki przestrzenne -->
<!-- json -->
<!-- tworzenie polaczen -->

## Działania na plikach i folderach

`dir.create("dane")`

`dir.exists("dane")`, `unlink("dane", recursive = TRUE)`

`zip()`, `unzip()`

`file.exist()`, `file.remove()`

## Zadania

<!-- wczytaj jeden format, zapisz inny -->
<!-- automatycznie wczytaj dwa pliki -->
<!-- wczytaj, zamien, zapisz -->
<!-- napisz funkcje do zamiany -->

