# Tekst {#tekst}

Więcej na temat przetwarzania tekstu można znaleźć w rozdziale ["Strings"](https://r4ds.had.co.nz/strings.html) książki R for Data Science [@grolemund_r_2016].

Typ znakowy jest określany poprzez użycie cudzysłowia `"` lub `'`.
Ważne tutaj jest, aby rozpoczynać i kończyć tekst tym samym cudzysłowiem.

```{r}
t1 = "kot"
t2 = 'pies'
t3 = '"W teorii, teoria i praktyka są tym samym. W praktyce, nie są." - Yogi Berra'
```

W momencie, gdy tekst nie będzie kończył się cudzysłowiem, wykonanie kodu jest niemożliwe.
Wówczas zamiast znaku `>`, oznaczającego nową linię wykonywanego kodu, pojawi się znak `+`.
Oznacza on, że wykonanie kodu nie może zostać zakończone.

```{r, eval=FALSE}
> "Mój pierwszy alfabet
+
+
```

W takiej sytuacji należy nacisnąć klawisz Esc, aby przerwać wykonywanie operacji, a następnie poprawić wpisany kod.

## Łączenie tekstu

```{r}
paste("t", "o", " ", "k", "o", "t")
```

```{r}
paste0("t", "o", " ", "k", "o", "t")
```

<!-- ^[funkcja `str_c()`] -->

```{r}
imie = "Olek"
wiek = 7
tekst1 = paste(imie, "ma", wiek, "lat.")
tekst1
```

## Postawowe operacje na tekście

[@R-stringr]

```{r}
library(stringr)
```

```{r}
toupper(tekst1)
```

```{r}
tolower(tekst1)
```

```{r}
tekst2 = c("chronologia", "alfabet", "hałas")
```

```{r}
str_sort(tekst2, locale = "pl")
str_sort(tekst2, locale = "cs")
```


```{r}
tekst3 = c("chronologia ", "alfabet", " hałas")
str_sort(tekst3, locale = "pl")
```

```{r}
tekst3 = str_trim(tekst3)
tekst3
str_sort(tekst3, locale = "pl")
```

## Wydzielanie tekstu

```{r}
str_sub(tekst1, start = 1, end = 4)
```

```{r}
str_sub(tekst1, start = 9, end = 14)
```

```{r}
str_sub(tekst1, start = 9, end = -1)
```

```{r}
str_sub(tekst1, start = -6, end = -1)
```

## Wyrażenia regularne 

<!-- https://github.com/VerbalExpressions/JSVerbalExpressions -->
<!-- https://github.com/richierocks/rebus/blob/master/README.md -->
<!-- https://www.garrickadenbuie.com/project/regexplain/ -->
<!-- https://github.com/kevinushey/rex -->

```{r, echo=FALSE, eval=FALSE}
x = c("Regular expression", "Regexp", "Regex")
str_detect(x, "^Reg(exp?|ular expression)$")
```

Wyrażenia regularne (ang. *regular expressions*), często określane jako *regex* to sposób opisywanie wzorców tekstu. 
Używając wyrażeń regularnych możliwe jest, między innymi, znajdowanie tekstu lub zamienienie, który spełnia wymagane warunki.
Wyrażenia regularne są powszechnie używane w wyszukiwarkach internetowych, edytorach tekstu, oraz wielu językach programowania.

<!-- basic stuff -->


```{r}
tekst4 = c("Magdalena", "Lena", "1Lena.csv", "LLena", "Helena", "Anna", 99)
```

```{r}
str_detect(tekst4, "Lena")
```

```{r}
str_detect(tekst4, "lena")
```

```{r regexoperators, echo=FALSE}
library(tibble)
roperators = c("^", 
               "$", "()", 
               "|", "[]", 
               "[^]",
               "*", "+", 
               "?", "{n}", 
               ".", "\\\\"
               )

roperators_exp = c("Określa początek tekstu/linii",
                   "Określa koniec testu/linii", "Grupowanie",
                   "Alternatywa (lub)", "Wymienia dozwolone znaki",
                   "Wymienia niedozwolone znaki",
                   "Poprzedni znak zostanie wybrany zero lub więcej razy", 
                   "Poprzedni znak zostanie wybrany jeden lub więcej razy", 
                   "Poprzedni znak zostanie wybrany zero lub jeden raz", 
                   "Poprzedni znak zostanie wybrany n razy", 
                   "Jakikolwiek znak oprócz nowej linii (\\n)",
                   "Pozwala na użycie specjalnych znaków")
knitr::kable(tibble(Operator = roperators, Wyjaśnienie = roperators_exp), 
             caption = "Metaznaki w wyrażeniach regularnych",
             booktabs = TRUE)
```

Wymienione powyżej znaki (np. `^`<!--Kareta--> czy `.`) określane są jako metaznaki (ang. *metacharacters*) i mają one specjalne znaczenie.
W związku z tym, jeżeli chcemy wyszukać tekstu zawierającego specjalny znak, musimy użyć ukośnik wsteczny (`\`, ang. *backslash*).
Istnieje wiele dodatkowych znaków specjalnych, np. `\n` - nowa linia, `\t` - tabulator, `\d` - każdy znak numeryczny (stałoprzecinkowy), `\s` - znak niedrukowalny, np. spacja, tabulator, nowa linia.
<!-- ranges [a-z0-9] -->
<!-- link to the cheetsheet -->

```{r}
str_detect(tekst4, pattern = "^L")
```

```{r}
str_detect(tekst4, pattern = "ena$")
```

```{r}
str_detect(tekst4, pattern = "(ena|nna)$")
```

```{r}
str_detect(tekst4, pattern = "[a-zA-Z]")
```

```{r}
str_detect(tekst4, pattern = "[0-9]")
```

```{r}
str_detect(tekst4, pattern = "L+")
```

```{r}
str_detect(tekst4, pattern = "^[^L]+")
```

```{r, eval=FALSE}
>str_detect(tekst4, pattern = "\.")
#> Error: '\.' is an unrecognized escape in character string starting ""\."
```

```{r}
str_detect(tekst4, pattern = "\\.")
```

```{r}
# str_detect(tekst4, pattern = "")
```

<!-- block z popularnymi regex -->

```{r, eval=FALSE}
y = c("kołdra", "kordła", "pościel")
str_detect(y, pattern = "ko(łdr|rdł)a")
```

## Wydzielanie tekstu - wyrażenia regularne 

<!-- https://r4ds.had.co.nz/strings.html#extract-matches -->
```{r}
# str_extract()
```

## Zamiana tekstu - wyrażenia regularne

<!-- https://r4ds.had.co.nz/strings.html#replacing-matches -->
```{r}
# str_replace()
```

<!-- https://stringr.tidyverse.org/articles/regular-expressions.html -->
Umiejętności używania wyrażeń regularnych można trenować używając różnych zasobów internetowych, np. strony https://regexr.com/ lub https://regex101.com/.
<!-- https://regexcrossword.com/ -->
<!-- https://www.amazon.com/Mastering-Regular-Expressions-Jeffrey-Friedl/dp/0596528124/ref=sr_1_1?ie=UTF8&qid=1464113797&sr=8-1&keywords=mastering+regular+expressions -->
<!-- Lea Verou [Best of Fluent 2012: /Reg(exp){2}lained/: Demystifying Regular Expressions](https://www.youtube.com/watch?v=EkluES9Rvak) -->

## Wyszukiwanie plików

<!-- `dir()` -->

## Zadania

<!-- match hex colors, examples :#abs, #f0, #BADA55, #COFFEE https://www.youtube.com/watch?v=EkluES9Rvak -->
<!-- match coordinates -->
<!-- match dates -->
